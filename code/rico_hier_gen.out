Using device: cuda:2
Object Category: Rico
Random Seed: 3124256514
Using dataset: datasets.RicoHierDataset
is_train: True #examples: 31470 #original: 31470 #permutes: 1
is_train: False #examples: 10490 #original: 10490 #permutes: 1
Starting training ...... 
training run rico_hier_vae
     Time    Epoch     Dataset    Iteration    Progress(%)       LR       BoxLoss   StructLoss   EdgeExists  KLDivLoss   SymLoss    AdjLoss  AnchorLoss  TotalLoss
 00:03:08     0/40     training      0/984         0.0%      1.00E-03    10866.91     1990.51       0.04   12857.46
Saving checkpoint ...... DONE
 00:07:23     0/40    validation     0/328         0.0%      1.00E-03     6003.68     1368.73       0.02    7372.44
 02:36:38     0/40    validation    10/328         0.1%      1.00E-03     4404.90     1552.83       0.02    5957.74
 02:38:09     0/40     training     30/984         0.1%      1.00E-03     2529.09      918.83       0.02    3447.94
 05:04:55     0/40    validation    20/328         0.2%      1.00E-03     3018.58     1005.93       0.07    4024.57
 05:06:52     0/40     training     60/984         0.2%      1.00E-03     2943.24     1193.10       0.02    4136.36
 07:58:55     0/40    validation    30/328         0.2%      1.00E-03     3606.13     1408.57       0.03    5014.73
 08:06:11     0/40     training     90/984         0.2%      1.00E-03     8014.90     5337.51       0.03   13352.44
 10:47:23     0/40    validation    40/328         0.3%      1.00E-03     6300.03     1826.99       0.03    8127.04
 10:49:08     0/40     training    120/984         0.3%      1.00E-03     2882.80     1023.79       0.03    3906.62
 13:29:56     0/40    validation    50/328         0.4%      1.00E-03     4046.98     1277.83       0.15    5324.95
 13:32:57     0/40     training    150/984         0.4%      1.00E-03     3995.87     1244.90       0.14    5240.92
 16:20:03     0/40    validation    60/328         0.5%      1.00E-03     3110.17     1013.41       0.03    4123.61
 16:20:45     0/40     training    180/984         0.5%      1.00E-03     1874.29      678.15       0.03    2552.46
 17:46:58     0/40    validation    70/328         0.5%      1.00E-03     3801.18     1311.18       0.04    5112.41
 17:47:49     0/40     training    210/984         0.5%      1.00E-03     2239.88      709.21       0.04    2949.13
 19:26:36     0/40    validation    80/328         0.6%      1.00E-03     3393.85     1331.92       0.05    4725.83
 19:28:52     0/40     training    240/984         0.6%      1.00E-03     4866.76     2359.11       0.12    7225.99
 20:56:21     0/40    validation    90/328         0.7%      1.00E-03     2818.68      850.59       0.46    3669.73
 20:57:44     0/40     training    270/984         0.7%      1.00E-03     3350.64     1236.21       0.53    4587.38
Traceback (most recent call last):
  File "train_rico_hier.py", line 367, in <module>
    config.epochs = 40 
  File "train_rico_hier.py", line 175, in train
    total_loss = forward(
  File "train_rico_hier.py", line 273, in forward
    print(f'Time elapsed for 1 object encoding = {toc_obj_enc} sec')
  File "/home/dipu/dipu_ps/codes/UIGeneration/structurenet/code/model_rico_hier.py", line 609, in structure_recon_loss
    losses, _, _ = self.node_recon_loss(root_latent, gt_tree.root)
  File "/home/dipu/dipu_ps/codes/UIGeneration/structurenet/code/model_rico_hier.py", line 799, in node_recon_loss
    child_feats[:, matched_pred_idx[i], :], gt_node.children[matched_gt_idx[i]])
  File "/home/dipu/dipu_ps/codes/UIGeneration/structurenet/code/model_rico_hier.py", line 799, in node_recon_loss
    child_feats[:, matched_pred_idx[i], :], gt_node.children[matched_gt_idx[i]])
  File "/home/dipu/dipu_ps/codes/UIGeneration/structurenet/code/model_rico_hier.py", line 799, in node_recon_loss
    child_feats[:, matched_pred_idx[i], :], gt_node.children[matched_gt_idx[i]])
  [Previous line repeated 3 more times]
  File "/home/dipu/dipu_ps/codes/UIGeneration/structurenet/code/model_rico_hier.py", line 637, in node_recon_loss
    self.child_decoder(node_latent)   #[1, 10, 256],  [1, 10, 58], [1, 10, 1]
  File "/home/dipu/anaconda3/envs/ui-gen/lib/python3.6/site-packages/torch/nn/modules/module.py", line 727, in _call_impl
    result = self.forward(*input, **kwargs)
  File "/home/dipu/dipu_ps/codes/UIGeneration/structurenet/code/model_rico_hier.py", line 429, in forward
    new_child_feats = torch_scatter.scatter_mean(node_edge_feats, edge_indices_from, dim=0, out=new_child_feats)
RuntimeError: The following operation failed in the TorchScript interpreter.
Traceback of TorchScript (most recent call last):
  File "/home/dipu/anaconda3/envs/ui-gen/lib/python3.6/site-packages/torch_scatter/scatter.py", line 49, in scatter_mean

    ones = torch.ones(index.size(), dtype=src.dtype, device=src.device)
    count = scatter_sum(ones, index, index_dim, None, dim_size)
            ~~~~~~~~~~~ <--- HERE
    count.clamp_(1)
    count = broadcast(count, out, dim)
  File "/home/dipu/anaconda3/envs/ui-gen/lib/python3.6/site-packages/torch_scatter/scatter.py", line 48, in scatter_sum
        index_dim = index.dim() - 1

    ones = torch.ones(index.size(), dtype=src.dtype, device=src.device)
           ~~~~~~~~~~ <--- HERE
    count = scatter_sum(ones, index, index_dim, None, dim_size)
    count.clamp_(1)
RuntimeError: CUDA out of memory. Tried to allocate 2.00 MiB (GPU 2; 7.80 GiB total capacity; 6.87 GiB already allocated; 2.31 MiB free; 6.88 GiB reserved in total by PyTorch)

